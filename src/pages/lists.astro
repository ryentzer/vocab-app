---
import { getLists, getListWordCount } from '../lib/db.js';
import Nav from '../components/Nav.astro';
import Head from '../components/Head.astro';
import Foot from '../components/Foot.astro';

const userId = Astro.locals.user!.id;
const lists = getLists(userId);

const listsWithCount = lists.map(l => ({
  ...l,
  word_count: getListWordCount(l.id),
}));
---

<Head title="VocabUp â€” My Lists" />
<Nav />

<main class="max-w-4xl mx-auto px-6 py-10">
  <div class="flex items-center justify-between mb-8">
    <div>
      <h1 class="text-3xl font-bold text-gray-900">My Lists</h1>
      <p class="text-gray-500 mt-1">Organize words into custom study groups.</p>
    </div>
    <a
      href="/lists/new"
      class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold px-5 py-2.5 rounded-xl transition-colors text-sm"
    >
      + New List
    </a>
  </div>

  {listsWithCount.length === 0 ? (
    <div class="bg-white rounded-2xl border border-gray-100 shadow-sm p-12 text-center">
      <i class="fa-solid fa-layer-group text-5xl text-indigo-300 mb-4 block"></i>
      <h2 class="text-xl font-semibold text-gray-700 mb-2">No lists yet</h2>
      <p class="text-gray-500 mb-6">Create your first list to organize words by topic, chapter, or any theme you like.</p>
      <a href="/lists/new" class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold px-6 py-3 rounded-xl transition-colors">
        Create a List
      </a>
    </div>
  ) : (
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      {listsWithCount.map(list => (
        <a href={`/lists/${list.id}`} class="bg-white hover:bg-indigo-50 rounded-2xl border border-gray-100 shadow-sm p-6 transition-colors group">
          <div class="flex items-start justify-between mb-3">
            <h2 class="text-lg font-semibold text-gray-900 group-hover:text-indigo-700 transition-colors">{list.name}</h2>
            <span class="text-xs font-medium bg-indigo-100 text-indigo-700 px-2 py-1 rounded-full ml-2 shrink-0">
              {list.word_count} word{list.word_count !== 1 ? 's' : ''}
            </span>
          </div>
          {list.description && (
            <p class="text-sm text-gray-500 line-clamp-2">{list.description}</p>
          )}
          <p class="text-xs text-gray-400 mt-3">
            Created {new Date(list.created_at).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}
          </p>
        </a>
      ))}
    </div>
  )}
</main>

<Foot />
